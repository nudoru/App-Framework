# Flow of route changes in the Application

## Diagram

┌──────────────────────────┐                               ┌──────────────────────────┐
│ ┌──────────────────────┐ │                               │ ┌──────────────────────┐ │
│ │      URL Change      │ │░░                             │ │  change route event  │ │░░
│ └──────────────────────┘ │░░                             │ └──────────────────────┘ │░░
└─────────────┬────────────┘░░                             └─────────────┬────────────┘░░
  ░░░░░░░░░░░░│░░░░░░░░░░░░░░░                               ░░░░░░░░░░░░│░░░░░░░░░░░░░░░
┌─────────────▼────────────┐░░                             ┌─────────────▼────────────┐░░
│ ┌──────────────────────┐ │                               │ ┌──────────────────────┐ │
│ │ URLHashChangeCommand │ │                               │ │  RouteChangeCommand  │ │
│ └──────────────────────┘ │                               │ └──────────────────────┘ │
└─────────────┬────────────┘                               └─────────────┬────────────┘
              │                                                          │
              │              ┌──────────────────────────┐                │
              │              │ ┌──────────────────────┐ │                │
              └─────────────▶│ │ APP.setCurrentRoute  │ │◀───────────────┘
                             │ └──────────────────────┘ │
                             └─────────────┬────────────┘
                                           ▼
                                           Λ
                                          ╱ ╲
                                         ╱   ╲
                                        ╱     ╲
                                       ╱       ╲     ┌──────────────────────────┐
                                      ╱┌───────┐╲    │ ┌──────────────────────┐ │
                                     ▕ │mapped?│ ▏───▶ │ Router.setRoute(last │ │
                                      ╲└───────┘╱    │ │ valid stored route)  │ │
                                       ╲       ╱     │ └──────────────────────┘ │
                                        ╲     ╱      └──────────────────────────┘
                                         ╲   ╱
                                          ╲ ╱
                                           V

                             ┌──────────────────────────┐
                             │ ┌──────────────────────┐ │
                             │ │ store current route  │ │
                             │ └──────────────────────┘ │
                             └─────────────┬────────────┘
                                           ▼
                                           Λ
                                          ╱ ╲
                                         ╱   ╲
                                        ╱     ╲
       ┌──────────────────────────┐    ╱       ╲     ┌──────────────────────────┐
       │ ┌──────────────────────┐ │   ╱┌───────┐╲    │ ┌──────────────────────┐ │
       │ │Router.runCurrentRoute│ ◀──▕ │ from  │ ▏───▶ │   Router.setRoute    │ │
       │ └──────────────────────┘ │   ╲│ URL?  │╱    │ └──────────────────────┘ │
       └─────────────┬────────────┘    └───────┘     └─────────────┬────────────┘
                     │                  ╲     ╱                    │
                     │                   ╲   ╱                     │
                     │                    ╲ ╱                      │
                     │                     V                       │
                     │                                             │
                     │                                             │
                     │       ┌──────────────────────────┐          │
                     │       │ ┌──────────────────────┐ │          │
                     └──────▶│ │   Router.runRoute    │ │◀─────────┘
                             │ └──────────────────────┘ │
                             └─────────────┬────────────┘
                                           │
                             ┌─────────────▼────────────┐
                             │ ┌──────────────────────┐ │
                             │ │   route controller   │ │
                             │ │ call(window, {route, │ │
                             │ │  templateID, data})  │ │
                             │ └──────────────────────┘ │
                             └─────────────┬────────────┘
                                           │
                             ┌─────────────▼────────────┐
                             │ ┌──────────────────────┐ │
                             │ │   Router.runRoute    │ │
                             │ └──────────────────────┘ │
                             └─────────────┬────────────┘
                                           │
                             ┌─────────────▼────────────┐
                             │ ┌──────────────────────┐ │
                             │ │    View.showView     │ │
                             │ └──────────────────────┘ │
                             └─────────────┬────────────┘
                                           │
                             ┌─────────────▼────────────┐  ┌──────────────────────────┐
                             │ ┌──────────────────────┐ │  │ ┌──────────────────────┐ │
                             │ │ unmount current view │ │──▶ │ subview.willUnmount  │ │
                             │ └──────────────────────┘ │  │ └──────────────────────┘ │
                             └─────────────┬────────────┘  └──────────────────────────┘
                                           │
                             ┌─────────────▼────────────┐
                             │ ┌──────────────────────┐ │
                             │ │subview.controller.ini│ │
                             │ └──────────────────────┘ │
                             └─────────────┬────────────┘
                                           │
                             ┌─────────────▼────────────┐
                             │ ┌──────────────────────┐ │
                             │ │  append to subview   │ │
                             │ │      mountpoint      │ │
                             │ └──────────────────────┘ │
                             └─────────────┬────────────┘
                                           │
                             ┌─────────────▼────────────┐
                             │ ┌──────────────────────┐ │
                             │ │ subview.viewDidMount │ │░░
                             │ └──────────────────────┘ │░░
                             └──────────────────────────┘░░
                               ░░░░░░░░░░░░░░░░░░░░░░░░░░░░
                               ░░░░░░░░░░░░░░░░░░░░░░░░░░░░