/*! app-framework 30-05-2015 */
define("Nori.Events.AppEvents",function(a,b,c){c.APP_INITIALIZED="APP_INITIALIZED",c.MODEL_DATA_WAITING="MODEL_DATA_WAITING",c.MODEL_DATA_READY="MODEL_DATA_READY",c.RESUME_FROM_MODEL_STATE="RESUME_FROM_MODEL_STATE",c.VIEW_INITIALIZED="VIEW_INITIALIZED",c.VIEW_RENDERED="VIEW_RENDERED",c.VIEW_CHANGED="VIEW_CHANGED",c.VIEW_CHANGE_TO_MOBILE="VIEW_CHANGE_TO_MOBILE",c.VIEW_CHANGE_TO_DESKTOP="VIEW_CHANGE_TO_DESKTOP",c.ROUTE_CHANGED="ROUTE_CHANGED",c.CHANGE_ROUTE="CHANGE_ROUTE",c.SUBVIEW_STORE_DATA="SUBVIEW_STORE_DATA"}),define("Nori.Events.Emitter",function(a,b,c){function d(a,b,c){return h[a]||(h[a]=[]),h[a]={once:c,handler:b,subject:new Rx.Subject},h[a].subject.subscribe(b)}function e(b,c,e){var f=a(c);if(f.hasOwnProperty("execute"))return d(b,f.execute,e);throw new Error("Emitter cannot map "+b+" to command "+c+": must have execute()")}function f(a,b){var c=h[a];c&&(c.subject.onNext(b),c.once&&(c.subject.onCompleted(),c.subject.dispose(),c=null))}function g(){var a=h;for(var b in a)hasOwnProp.call(a,b)&&a[b].subject.dispose();h={}}var h={};c.subscribe=d,c.subscribeCommand=e,c.publish=f,c.dispose=g}),define("Nori.Model",function(a,b,c){function d(){k.publish(l.MODEL_DATA_WAITING)}function e(a){i=a,k.publish(l.MODEL_DATA_READY)}function f(){return i.slice(0)}function g(a,b){j[a]=b}function h(a){return j[a]||{}}var i,j=Object.create(null),k=a("Nori.Events.Emitter"),l=a("Nori.Events.AppEvents");c.initialize=d,c.setData=e,c.getData=f,c.storeSubViewData=g,c.retrieveSubViewData=h}),define("Nori.View.BaseSubView",function(a,b,c){function d(a){r=a.modelData,k?e(a.state):(k=a,l=a.id,m=a.template,p=q=a.state,f())}function e(a){return q=a,f()}function f(){return n=m(q),o=s.HTMLStrToNode(n)}function g(){}function h(){t.publish(u.SUBVIEW_STORE_DATA,{id:l,data:q})}function i(){return l}function j(){return o}var k,l,m,n,o,p,q,r,s=a("nudoru.utils.DOMUtils"),t=a("Nori.Events.Emitter"),u=a("Nori.Events.AppEvents");c.initialize=d,c.update=e,c.render=f,c.getID=i,c.getDOMElement=j,c.viewDidMount=g,c.viewWillUnMount=h}),define("Nori.BasicView",function(a,b,c){function d(){f=this,g.publish(Nori.AppEvents.VIEW_INITIALIZED),e()}function e(){g.publish(Nori.AppEvents.VIEW_RENDERED)}var f,g=Nori.eventDispatcher();c.initialize=d,c.render=e}),define("Nori.View.MixinBrowserEvents",function(a,b,c){function d(){l(),n(),f()}function e(a){u=a}function f(){var a=Rx.Observable.fromEvent(window,"resize"),b=Rx.Observable.fromEvent(_mainScrollEl,"scroll");r=Rx.Observable.merge(a,b).subscribe(function(){o()}),t=Rx.Observable.fromEvent(window,"resize").throttle(100).subscribe(function(){i()}),s=Rx.Observable.fromEvent(_mainScrollEl,"scroll").throttle(100).subscribe(function(){j()})}function g(){return _mainScrollEl}function h(a){_mainScrollEl=document.getElementById(a)}function i(){v.publish(w.BROWSER_RESIZED,p)}function j(){v.publish(w.BROWSER_SCROLLED,q)}function k(){return p}function l(){p={width:window.innerWidth,height:window.innerHeight}}function m(){return q}function n(){var a=_mainScrollEl?_mainScrollEl:document.body,b=a.scrollLeft,c=a.scrollTop;b=b?b:0,c=c?c:0,q={left:b,top:c}}function o(){n(),l(),u.call(this,p,q)}var p,q,r,s,t,u,v=a("Nori.Events.Emitter"),w=a("nudoru.events.BrowserEvents");c.initializeEventStreams=d,c.setPositionUIElementsOnChangeCB=e,c.getMainScrollingView=g,c.setMainScrollingView=h,c.getCurrentViewPortSize=k,c.getCurrentViewPortScroll=m}),define("Nori.View.MixinMultiDeviceView",function(a,b,c){function d(){s=!1,t=750,u=475,v=250,w=!1,q=document.getElementById("app__contents"),n=document.getElementById("drawer"),o=document.querySelector(".drawer__menu-spinner-button > input"),n&&TweenLite.to(n,0,{x:-1*v}),e(),f()}function e(){r=Rx.Observable.fromEvent(window,"resize").throttle(10).subscribe(function(){f()}),o&&(p=Rx.Observable.fromEvent(o,"change").subscribe(function(){k()}))}function f(){g(),h()}function g(){x={width:window.innerWidth,height:window.innerHeight}}function h(){x.width<=t||z.mobile.any()?i():x.width>t&&j()}function i(){s||(s=!0,A.publish(y.VIEW_CHANGE_TO_MOBILE))}function j(){s&&(s=!1,m(),A.publish(y.VIEW_CHANGE_TO_DESKTOP))}function k(){w?m():l()}function l(){w=!0,TweenLite.to(n,.5,{x:0,ease:Quad.easeOut}),TweenLite.to(q,.5,{x:v,ease:Quad.easeOut})}function m(){w=!1,TweenLite.to(n,.5,{x:-1*v,ease:Quad.easeOut}),TweenLite.to(q,.5,{x:0,ease:Quad.easeOut})}var n,o,p,q,r,s,t,u,v,w,x,y=a("Nori.Events.AppEvents"),z=a("nudoru.utils.BrowserInfo"),A=a("nudoru.events.EventDispatcher");c.initialize=d,c.openDrawer=l,c.closeDrawer=m,c.checkForMobile=h}),define("Nori.View.MixinRouteViews",function(a,b,c){function d(a){i=document.getElementById(a)}function e(){return k}function f(a,b){var c=requireUnique(m),d=requireUnique(b);l[a]={htmlTemplate:k.getTemplate(n+a),controller:Nori.extend(d,c)}}function g(a,b){if(!i)throw new Error("No subview mount point set");var c=l[a.templateID];if(!c)throw new Error("No subview mapped for route: "+a.route+" > "+a.templateID);h(),c.controller.initialize({id:a.templateID,template:c.htmlTemplate,state:a.data,modelData:b}),TweenLite.set(i,{alpha:0}),i.appendChild(c.controller.getDOMElement()),j=a.templateID,c.controller.viewDidMount&&c.controller.viewDidMount(),TweenLite.to(i,.25,{alpha:1,ease:Quad.easeIn}),q.publish(o.VIEW_CHANGED,a.templateID)}function h(){if(j){var a=l[j].controller;a.viewWillUnMount&&a.viewWillUnMount()}j="",p.removeAllElements(i)}var i,j,k=a("Nori.View.Template"),l=Object.create(null),m="Nori.View.BaseSubView",n="template__",o=a("Nori.Events.AppEvents"),p=a("nudoru.utils.DOMUtils"),q=a("Nori.Events.Emitter");c.setSubViewMountPoint=d,c.template=e,c.mapView=f,c.showView=g}),define("Nori.View.Template",function(a,b,c){function d(a){if(i[a])return i[a];var b=document.getElementById(a),c="",d="";if(!b)throw new Error('nudoru.utils.NTemplate, template not found: "'+a+'"');return c=b.innerHTML,d=h(c),i[a]=d,d}function e(a){if(j[a])return j[a];var b=_.template(d(a));return j[a]=b,b}function f(a,b){var c=e(a);return c(b)}function g(a,b){return k.HTMLStrToNode(f(a,b))}function h(a){return a.trim()}var i=Object.create(null),j=Object.create(null),k=a("nudoru.utils.DOMUtils");c.getSource=d,c.getTemplate=e,c.asHTML=f,c.asElement=g}),define("Nori.View",function(a,b,c){function d(){return p}function e(){return q}function f(){g()}function g(){p=document.getElementById("app__container"),q=document.getElementById("app__contents"),r.setMainScrollingView("app__contents"),r.initializeEventStreams(),r.setPositionUIElementsOnChangeCB(h),s.setSubViewMountPoint("contents"),u.initialize("tooltip__container"),t.initialize("toast__container"),v.initialize("messagebox__container"),w.initialize()}function h(){}function i(a){v.add(a)}function j(a){i({title:"Alert",content:a,type:v.type().DEFAULT,modal:!1})}function k(a){t.add(a)}function l(a,b,c){k({title:b||"Notification",type:c||t.type().DEFAULT,message:a})}function m(){var a=document.getElementById("initialization__cover"),b=document.getElementsByClassName("initialization__message")[0];TweenLite.to(a,1,{alpha:0,ease:Quad.easeOut,onComplete:function(){document.body.removeChild(a)}}),TweenLite.to(b,2,{top:"+=50px",ease:Quad.easeIn,onComplete:function(){a.removeChild(b)}})}function n(a,b){s.mapView(a,b)}function o(a,b){s.showView(a,b)}var p,q,r=a("Nori.View.MixinBrowserEvents"),s=a("Nori.View.MixinRouteViews"),t=a("nudoru.components.ToastView"),u=a("nudoru.components.ToolTipView"),v=a("nudoru.components.MessageBoxView"),w=a("nudoru.components.ModalCoverView");c.initialize=f,c.addMessageBox=i,c.addNotification=k,c.alert=j,c.notify=l,c.removeLoadingMessage=m,c.mapView=n,c.showView=o,c.layoutUI=h,c.getAppContainerEl=d,c.getAppEl=e}),define("Nori.Router",function(a,b,c){function d(){window.addEventListener("hashchange",f,!1)}function e(a,b){n[a]={templateID:b.templateID,controller:b.controller}}function f(){o.publish(p.URL_HASH_CHANGED,{routeObj:g(),fragment:l()})}function g(){var a=l(),b=a.split("?"),c="/"+b[0],d=decodeURIComponent(b[1]),e=i(d);return{route:c,data:e}}function h(){var a=g();j(a.route,a.data)}function i(a){var b={},c=a.split("&");return c.forEach(function(a){var c=a.split("=");b[c[0]]=c[1]}),b}function j(a,b){var c=n[a];c?c.controller.call(window,{route:a,templateID:c.templateID,data:b}):console.log('No Route mapped for: "'+a+'"')}function k(a,b){var c=a,d=[];if(null!==b&&void 0!==b){c+="?";for(var e in b)"undefined"!==e&&b.hasOwnProperty(e)&&d.push(e+"="+encodeURIComponent(b[e]));c+=d.join("&")}m(c)}function l(){var a=location.hash.slice(1);return a.toString().replace(/\/$/,"").replace(/^\//,"")}function m(a){window.location.hash=a}var n=Object.create(null),o=a("Nori.Events.Emitter"),p=a("nudoru.events.BrowserEvents");c.initialize=d,c.when=e,c.getCurrentRoute=g,c.runCurrentRoute=h,c.setRoute=k}),define("Nori.BrowserResizedCommand",function(a,b,c){c.execute=function(a){console.log("BrowserResizedCommand: "+a.width+"w, "+a.height+"h")}}),define("Nori.BrowserScrolledCommand",function(a,b,c){c.execute=function(a){console.log("BrowserScrolledCommand: "+a.left+"l, "+a.top+"t")}}),define("Nori.ChangeRouteCommand",function(a,b,c){c.execute=function(a){console.log("ChangeRouteCommand, route: "+a.route),a.fromApp=!0,Nori.setCurrentRoute(a)}}),define("Nori.InitializeAppCommand",function(a,b,c){c.execute=function(){a("nudoru.events.BrowserEvents"),a("Nori.Events.AppEvents");console.log("InitializeAppCommand"),Nori.mapRouteView("/","ControlsTesting","Nori.View.ControlsTestingSubView",!1),Nori.mapRouteView("/test","TestSubView","Nori.View.TemplateSubView",!0),Nori.mapRouteView("/one","TestSubView1","Nori.View.TemplateSubView",!0),Nori.mapRouteView("/two","TestSubView2","Nori.View.TemplateSubView",!0),Nori.mapRouteView("/three","TestSubView3","Nori.View.TemplateSubView",!0),Nori.view().removeLoadingMessage(),Nori.setCurrentRoute(Nori.router().getCurrentRoute())}}),define("Nori.ModelDataWaitingCommand",function(a,b,c){c.execute=function(){console.log("ModelDataWaitingCommand, injecting data"),Nori.model().setData({})}}),define("Nori.RouteChangedCommand",function(a,b,c){c.execute=function(){}}),define("Nori.SubViewStoreDataCommand",function(a,b,c){c.execute=function(a){Nori.model().storeSubViewData(a.id,a.data)}}),define("Nori.URLHashChangedCommand",function(a,b,c){c.execute=function(a){Nori.setCurrentRoute(a.routeObj)}}),define("Nori.ViewChangedCommand",function(a,b,c){c.execute=function(a){console.log("ViewChangedCommand: "+a)}}),define("Nori.ViewChangedToDesktopCommand",function(a,b,c){c.execute=function(a){console.log("ViewChangedToDesktopCommand: "+a)}}),define("Nori.ViewChangedToMobileCommand",function(a,b,c){c.execute=function(a){console.log("ViewChangedToMobileCommand: "+a)}});var Nori=function(){function a(){return C}function b(){return D}function c(){return x}function d(){return w}function e(){return B.extend({},v)}function f(a,b){console.log("Nori: Initialize"),g(),D.initialize(),w=a,x=b,h()}function g(){v={appConfig:APP_CONFIG_DATA,routes:[],currentRoute:{route:"/",data:void 0}}}function h(){x.initialize(),i()}function i(){C.subscribe(z.MODEL_DATA_READY,j,!0),w.initialize()}function j(){k()}function k(){l(),C.publish(z.APP_INITIALIZED)}function l(){r(A.URL_HASH_CHANGED,"Nori.URLHashChangedCommand"),r(z.CHANGE_ROUTE,"Nori.ChangeRouteCommand"),r(z.SUBVIEW_STORE_DATA,"Nori.SubViewStoreDataCommand")}function m(a){v.routes.push(a)}function n(a){return v.routes.indexOf(a)>-1}function o(a){n(a.route)?(v.currentRoute=a,a.fromApp?D.setRoute(v.currentRoute.route,v.currentRoute.data):(D.runCurrentRoute(),C.publish(z.ROUTE_CHANGED,a))):D.setRoute(v.currentRoute.route,v.currentRoute.data)}function p(a,b){return a=_.assign({},b,a),a._super=b,a}function q(a){return p(a,this)}function r(a,b){y[a]=C.subscribeCommand(a,b)}function s(a,b,c){D.when(a,{templateID:b,controller:function(a){c.execute(a)}})}function t(a,b,c){m(a),x.mapView(b,c),D.when(a,{templateID:b,controller:function(a){u(a)}})}function u(a){x.showView(a,w.retrieveSubViewData(a.templateID))}var v,w,x,y=Object.create(null),z=require("Nori.Events.AppEvents"),A=require("nudoru.events.BrowserEvents"),B=require("nudoru.utils.ObjectUtils"),C=require("Nori.Events.Emitter"),D=require("Nori.Router");return{initialize:f,config:e,getEmitter:a,router:b,view:c,model:d,setCurrentRoute:o,mapRouteView:t,mapRouteCommand:s,mapEventCommand:r,extend:p,create:q}}();