/*! app-framework 09-06-2015 */
define("Nori.Events.AppEvents",function(a,b,c){c.APP_INITIALIZED="APP_INITIALIZED",c.MODEL_DATA_WAITING="MODEL_DATA_WAITING",c.MODEL_DATA_READY="MODEL_DATA_READY",c.MODEL_DATA_CHANGED="MODEL_DATA_CHANGED",c.MODEL_DATA_SAVED="MODEL_DATA_SAVED",c.MODEL_DATA_DESTROYED="MODEL_DATA_DESTROYED",c.UPDATE_MODEL_DATA="UPDATE_MODEL_DATA",c.RESUME_FROM_MODEL_STATE="RESUME_FROM_MODEL_STATE",c.VIEW_INITIALIZED="VIEW_INITIALIZED",c.VIEW_RENDERED="VIEW_RENDERED",c.VIEW_CHANGED="VIEW_CHANGED",c.VIEW_CHANGE_TO_MOBILE="VIEW_CHANGE_TO_MOBILE",c.VIEW_CHANGE_TO_DESKTOP="VIEW_CHANGE_TO_DESKTOP",c.ROUTE_CHANGED="ROUTE_CHANGED",c.CHANGE_ROUTE="CHANGE_ROUTE",c.SUBVIEW_STORE_STATE="SUBVIEW_STORE_STATE"}),define("Nori.Events.Emitter",function(a,b,c){function d(a,b,c){return h[a]||(h[a]=[]),h[a]={once:c,handler:b,subject:new Rx.Subject},h[a].subject.subscribe(b)}function e(b,c,e){var f=a(c);if(f.hasOwnProperty("execute"))return d(b,f.execute,e);throw new Error("Emitter cannot map "+b+" to command "+c+": must have execute()")}function f(a,b){var c=h[a];c&&(c.subject.onNext(b),c.once&&(c.subject.onCompleted(),c.subject.dispose(),c=null))}function g(){var a=h;for(var b in a)hasOwnProp.call(a,b)&&a[b].subject.dispose();h={}}var h={};c.subscribe=d,c.subscribeCommand=e,c.publish=f,c.dispose=g}),define("Nori.Model",function(a,b,c){function d(a){if(!a.id)throw new Error("Model must be init'd with an id");B=a.id,G=a.silent||!1,a.store&&(D=!0,F=a.store)}function e(){return B}function f(){F={},D=!0}function g(a,b){var c=!1;"object"==typeof a?(null!==b&&"object"==typeof b&&(c=b.silent||!1),F=_.merge({},F,a)):F[a]=b,D=!0,c||v()}function h(a){return i(a)?F[a]:void 0}function i(a){return F.hasOwnProperty(a)}function j(){if(!D&&E)return E;var a=[];for(var b in F)a.push({key:b,value:F[b]});return E=a,D=!1,a}function k(){return l().length}function l(){return Object.keys(F)}function m(){return j().map(function(a){return a.value})}function n(a){delete F[a]}function o(a){return m().filter(a)}function p(){return j()[0]}function q(){var a=j();return a[a.length-1]}function r(a){return j()[a]}function s(){return _.merge({},F)}function t(a){var b={};for(var c in a)F.hasOwnProperty(c)&&(b[a[c]]=F[c]);return b}function u(){return!0}function v(){G||H.publish(I.MODEL_DATA_CHANGED,{id:B,storeType:"model",store:s()}),C&&C.publishChange({id:B,store:s()})}function w(){}function x(){F=null,C=null}function y(){return JSON.stringify(F)}function z(a){C=a}function A(){return C}var B,C,D=!1,E=[],F={},G=!1,H=a("Nori.Events.Emitter"),I=a("Nori.Events.AppEvents");c.initialize=d,c.getID=e,c.clear=f,c.set=g,c.get=h,c.has=i,c.remove=n,c.keys=l,c.values=m,c.entries=j,c.filterValues=o,c.size=k,c.getFirst=p,c.getLast=q,c.getAtIndex=r,c.getStore=s,c.transform=t,c.validate=u,c.save=w,c.destroy=x,c.toJSON=y,c.setParentCollection=z,c.getParentCollection=A}),define("Nori.ModelCollection",function(a,b,c){function d(a){if(!a.id)throw new Error("ModelCollection must be init'd with an id");z=a.id,B=a.silent||!1}function e(a){a.forEach(function(a){h(a)})}function f(a,b,c){a.forEach(function(a){var d;d=a.hasOwnProperty(b)?a[b]:z+"child"+A.length,h(Nori.createModel({id:d,silent:c,store:a}))})}function g(){return z}function h(a){var b=k(a.getID());a.setParentCollection(this),b>=0?A[b]=a:A.push(a)}function i(a){var b=k(store.getID());b>=0?(A[b].setParentCollection(null),A[b]=null,A.splice(b,1)):console.log(z+" remove, model not in collection: "+a)}function j(a){return A.filter(function(b){return b.getID()===a})[0]}function k(a){return A.map(function(a){return a.getID()}).indexOf(a)}function l(a){B||C.publish(D.MODEL_DATA_CHANGED,{id:z,storeType:"collection",storeID:a.id,store:a.store})}function m(a){return A[a]?!0:!1}function n(){return A.length}function o(){return A[0]}function p(){return A[A.length-1]}function q(a){return A[a]}function r(a){return A.filter(a)}function s(a,b){return A.filter(function(c){return c.get(a)===b})}function t(){var a=[];return A.forEach(function(b){a.push(b.entries())}),a}function u(){}function v(){}function w(){return JSON.stringify(A)}function x(a){_parentCollection=a}function y(){return _parentCollection}var z,A=[],B=!1,C=a("Nori.Events.Emitter"),D=a("Nori.Events.AppEvents");c.initialize=d,c.getID=g,c.add=h,c.addStoresFromArray=e,c.addFromObjArray=f,c.remove=i,c.getStore=j,c.hasModel=m,c.size=n,c.getFirst=o,c.getLast=p,c.getAtIndex=q,c.filterCustom=r,c.filter=s,c.entries=t,c.save=u,c.destroy=v,c.toJSON=w,c.publishChange=l,c.setParentCollection=x,c.getParentCollection=y}),define("Nori.ApplicationView",function(a,b,c){function d(){return s}function e(){return t}function f(){g()}function g(){s=document.getElementById("app__container"),t=document.getElementById("app__contents"),u.setMainScrollingView("app__contents"),u.initializeEventStreams(),u.setPositionUIElementsOnChangeCB(h),v.setRouteViewMountPoint("contents"),x.initialize("tooltip__container"),w.initialize("toast__container"),y.initialize("messagebox__container"),z.initialize()}function h(){}function i(a){y.add(a)}function j(a){i({title:"Alert",content:a,type:y.type().DEFAULT,modal:!1})}function k(a){w.add(a)}function l(a,b,c){k({title:b||"Notification",type:c||w.type().DEFAULT,message:a})}function m(){var a=document.getElementById("initialization__cover"),b=document.getElementsByClassName("initialization__message")[0];TweenLite.to(a,1,{alpha:0,ease:Quad.easeOut,onComplete:function(){document.body.removeChild(a)}}),TweenLite.to(b,2,{top:"+=50px",ease:Quad.easeIn,onComplete:function(){a.removeChild(b)}})}function n(a,b,c){v.mapView(a,b,!1,c)}function o(a,b){v.showView(a,b)}function p(a,b){v.mapRouteView(a,b)}function q(a,b){v.showRouteView(a,b)}function r(a,b){v.updateViewData(a,b)}var s,t,u=a("Nori.View.BrowserEvents"),v=a("Nori.View.SubRouteViews"),w=a("nudoru.components.ToastView"),x=a("nudoru.components.ToolTipView"),y=a("nudoru.components.MessageBoxView"),z=a("nudoru.components.ModalCoverView");c.initialize=f,c.addMessageBox=i,c.addNotification=k,c.alert=j,c.notify=l,c.removeLoadingMessage=m,c.mapView=n,c.showView=o,c.mapRouteView=p,c.showRouteView=q,c.updateViewData=r,c.layoutUI=h,c.getAppContainerEl=d,c.getAppEl=e}),define("Nori.View.BaseSubView",function(a,b,c){function d(a){l?f(a):(l=a,m=a.id,n=a.template,q=r=e(a),g())}function e(a){return _.merge({},a.previousStateData,a.boundModelData,a.queryData)}function f(a){return r=e(a),console.log(m+", subview update state: "+JSON.stringify(r)),s?g():void 0}function g(){return o=n(r),p=t.HTMLStrToNode(o)}function h(){s=!0}function i(){s=!1,u.publish(v.SUBVIEW_STORE_STATE,{id:m,data:r})}function j(){return m}function k(){return p}var l,m,n,o,p,q,r,s=!1,t=a("nudoru.utils.DOMUtils"),u=a("Nori.Events.Emitter"),v=a("Nori.Events.AppEvents");c.initialize=d,c.update=f,c.render=g,c.getID=j,c.getDOMElement=k,c.viewDidMount=h,c.viewWillUnMount=i}),define("Nori.BasicView",function(a,b,c){function d(){f=this,g.publish(Nori.AppEvents.VIEW_INITIALIZED),e()}function e(){g.publish(Nori.AppEvents.VIEW_RENDERED)}var f,g=Nori.eventDispatcher();c.initialize=d,c.render=e}),define("Nori.View.BrowserEvents",function(a,b,c){function d(){l(),n(),f()}function e(a){u=a}function f(){var a=Rx.Observable.fromEvent(window,"resize"),b=Rx.Observable.fromEvent(_mainScrollEl,"scroll");r=Rx.Observable.merge(a,b).subscribe(function(){o()}),t=Rx.Observable.fromEvent(window,"resize").throttle(100).subscribe(function(){i()}),s=Rx.Observable.fromEvent(_mainScrollEl,"scroll").throttle(100).subscribe(function(){j()})}function g(){return _mainScrollEl}function h(a){_mainScrollEl=document.getElementById(a)}function i(){v.publish(w.BROWSER_RESIZED,p)}function j(){v.publish(w.BROWSER_SCROLLED,q)}function k(){return p}function l(){p={width:window.innerWidth,height:window.innerHeight}}function m(){return q}function n(){var a=_mainScrollEl?_mainScrollEl:document.body,b=a.scrollLeft,c=a.scrollTop;b=b?b:0,c=c?c:0,q={left:b,top:c}}function o(){n(),l(),u.call(this,p,q)}var p,q,r,s,t,u,v=a("Nori.Events.Emitter"),w=a("nudoru.events.BrowserEvents");c.initializeEventStreams=d,c.setPositionUIElementsOnChangeCB=e,c.getMainScrollingView=g,c.setMainScrollingView=h,c.getCurrentViewPortSize=k,c.getCurrentViewPortScroll=m}),define("Nori.View.MultiDeviceView",function(a,b,c){function d(){s=!1,t=750,u=475,v=250,w=!1,q=document.getElementById("app__contents"),n=document.getElementById("drawer"),o=document.querySelector(".drawer__menu-spinner-button > input"),n&&TweenLite.to(n,0,{x:-1*v}),e(),f()}function e(){r=Rx.Observable.fromEvent(window,"resize").throttle(10).subscribe(function(){f()}),o&&(p=Rx.Observable.fromEvent(o,"change").subscribe(function(){k()}))}function f(){g(),h()}function g(){x={width:window.innerWidth,height:window.innerHeight}}function h(){x.width<=t||z.mobile.any()?i():x.width>t&&j()}function i(){s||(s=!0,A.publish(y.VIEW_CHANGE_TO_MOBILE))}function j(){s&&(s=!1,m(),A.publish(y.VIEW_CHANGE_TO_DESKTOP))}function k(){w?m():l()}function l(){w=!0,TweenLite.to(n,.5,{x:0,ease:Quad.easeOut}),TweenLite.to(q,.5,{x:v,ease:Quad.easeOut})}function m(){w=!1,TweenLite.to(n,.5,{x:-1*v,ease:Quad.easeOut}),TweenLite.to(q,.5,{x:0,ease:Quad.easeOut})}var n,o,p,q,r,s,t,u,v,w,x,y=a("Nori.Events.AppEvents"),z=a("nudoru.utils.BrowserInfo"),A=a("nudoru.events.EventDispatcher");c.initialize=d,c.openDrawer=l,c.closeDrawer=m,c.checkForMobile=h}),define("Nori.View.SubRouteViews",function(a,b,c){function d(a){m=document.getElementById(a)}function e(){return o}function f(a,b,c,d){p[a]={htmlTemplate:o.getTemplate(r+a),controller:g(requireUnique(b)),isRouteView:c,mountPoint:d}}function g(a){return Nori.extend(a,requireUnique(q))}function h(a,b){f(a,b,!0,m)}function i(a,b){var c=p[a];c.controller.update&&c.controller.update({boundModelData:b})}function j(a,b){var c,d=p[a];if(!d)throw new Error("No subview mapped for id: "+b.templateID);d.controller.initialize({id:a,template:d.htmlTemplate,queryData:b}),c=document.getElementById(d.mountPoint),c.appendChild(d.controller.getDOMElement()),d.controller.viewDidMount&&d.controller.viewDidMount()}function k(a,b){if(!m)throw new Error("No subview mount point set");var c=p[a.templateID];if(!c)throw new Error("No subview mapped for route: "+a.route+" > "+a.templateID);l(),c.controller.initialize({id:a.templateID,template:c.htmlTemplate,queryData:a.queryData,previousStateData:b}),TweenLite.set(m,{alpha:0}),m.appendChild(c.controller.getDOMElement()),n=a.templateID,c.controller.viewDidMount&&c.controller.viewDidMount(),TweenLite.to(m,.25,{alpha:1,ease:Quad.easeIn}),u.publish(s.VIEW_CHANGED,a.templateID)}function l(){if(n){var a=p[n].controller;a.viewWillUnMount&&a.viewWillUnMount()}n="",t.removeAllElements(m)}var m,n,o=a("Nori.View.Template"),p=Object.create(null),q="Nori.View.BaseSubView",r="template__",s=a("Nori.Events.AppEvents"),t=a("nudoru.utils.DOMUtils"),u=a("Nori.Events.Emitter");c.setRouteViewMountPoint=d,c.template=e,c.createSubView=g,c.mapView=f,c.showView=j,c.mapRouteView=h,c.showRouteView=k,c.updateViewData=i}),define("Nori.View.Template",function(a,b,c){function d(a){if(i[a])return i[a];var b=document.getElementById(a),c="",d="";if(!b)throw new Error('nudoru.utils.NTemplate, template not found: "'+a+'"');return c=b.innerHTML,d=h(c),i[a]=d,d}function e(a){if(j[a])return j[a];var b=_.template(d(a));return j[a]=b,b}function f(a,b){var c=e(a);return c(b)}function g(a,b){return k.HTMLStrToNode(f(a,b))}function h(a){return a.trim()}var i=Object.create(null),j=Object.create(null),k=a("nudoru.utils.DOMUtils");c.getSource=d,c.getTemplate=e,c.asHTML=f,c.asElement=g}),define("Nori.Router",function(a,b,c){function d(){window.addEventListener("hashchange",f,!1)}function e(a,b){n[a]={templateID:b.templateID,controller:b.controller}}function f(){o.publish(p.URL_HASH_CHANGED,{routeObj:g(),fragment:l()})}function g(){var a=l(),b=a.split("?"),c="/"+b[0],d=decodeURIComponent(b[1]),e=i(d);return{route:c,data:e}}function h(){var a=g();j(a.route,a.data)}function i(a){var b={},c=a.split("&");return c.forEach(function(a){var c=a.split("=");b[c[0]]=c[1]}),b}function j(a,b){var c=n[a];c?c.controller.call(window,{route:a,templateID:c.templateID,queryData:b}):console.log('No Route mapped for: "'+a+'"')}function k(a,b){var c=a,d=[];if(null!==b&&void 0!==b){c+="?";for(var e in b)"undefined"!==e&&b.hasOwnProperty(e)&&d.push(e+"="+encodeURIComponent(b[e]));c+=d.join("&")}m(c)}function l(){var a=location.hash.slice(1);return a.toString().replace(/\/$/,"").replace(/^\//,"")}function m(a){window.location.hash=a}var n=Object.create(null),o=a("Nori.Events.Emitter"),p=a("nudoru.events.BrowserEvents");c.initialize=d,c.when=e,c.getCurrentRoute=g,c.runCurrentRoute=h,c.setRoute=k}),define("Nori.BrowserResizedCommand",function(a,b,c){c.execute=function(a){console.log("BrowserResizedCommand: "+a.width+"w, "+a.height+"h")}}),define("Nori.BrowserScrolledCommand",function(a,b,c){c.execute=function(a){console.log("BrowserScrolledCommand: "+a.left+"l, "+a.top+"t")}}),define("Nori.ChangeRouteCommand",function(a,b,c){c.execute=function(a){a.fromApp=!0,Nori.setCurrentRoute(a)}}),define("Nori.InitializeAppCommand",function(a,b,c){c.execute=function(){a("nudoru.events.BrowserEvents"),a("Nori.Events.AppEvents");console.log("InitializeAppCommand"),Nori.mapRouteView("/","ControlsTesting","Nori.View.ControlsTestingSubView",!1),Nori.mapRouteView("/test","TestSubView","Nori.View.TemplateSubView",!0),Nori.mapRouteView("/one","TestSubView1","Nori.View.TemplateSubView",!0),Nori.mapRouteView("/two","TestSubView2","Nori.View.TemplateSubView",!0),Nori.mapRouteView("/three","TestSubView3","Nori.View.TemplateSubView",!0),Nori.view().removeLoadingMessage(),Nori.setCurrentRoute(Nori.router().getCurrentRoute())}}),define("Nori.ModelDataChangedCommand",function(a,b,c){c.execute=function(a){"model"===a.storeType&&Nori.notifyBoundViewsOfModelUpdate(a.id,a.store)}}),define("Nori.RouteChangedCommand",function(a,b,c){c.execute=function(){}}),define("Nori.SubViewStoreDataCommand",function(a,b,c){c.execute=function(a){Nori.storeSubViewData(a.id,a.data)}}),define("Nori.URLHashChangedCommand",function(a,b,c){c.execute=function(a){Nori.setCurrentRoute(a.routeObj)}}),define("Nori.UpdateModelDataCommand",function(a,b,c){c.execute=function(a){console.log("UpdateModelDataCommand, model id: "+a.id+", with data:"),console.table(a.data)}}),define("Nori.ViewChangedCommand",function(a,b,c){c.execute=function(a){console.log("ViewChangedCommand: "+a)}}),define("Nori.ViewChangedToDesktopCommand",function(a,b,c){c.execute=function(a){console.log("ViewChangedToDesktopCommand: "+a)}}),define("Nori.ViewChangedToMobileCommand",function(a,b,c){c.execute=function(a){console.log("ViewChangedToMobileCommand: "+a)}});var Nori=function(){function a(){return L}function b(){return M}function c(){return D}function d(){return K.extend({},C)}function e(a){f(),M.initialize(),D=a.view,g(),h(),i()}function f(){C={appConfig:APP_CONFIG_DATA,routes:[],currentRoute:{route:"/",data:void 0}}}function g(){F=l({id:"SubViewDataModel",store:{},noisy:!0}),E=k({id:"GlobalModelCollection",silent:!1}),m(F)}function h(){D.initialize()}function i(){j(),L.publish(I.APP_INITIALIZED)}function j(){u(I.MODEL_DATA_CHANGED,"Nori.ModelDataChangedCommand"),u(I.UPDATE_MODEL_DATA,"Nori.UpdateModelDataCommand"),u(J.URL_HASH_CHANGED,"Nori.URLHashChangedCommand"),u(I.CHANGE_ROUTE,"Nori.ChangeRouteCommand"),u(I.SUBVIEW_STORE_STATE,"Nori.SubViewStoreDataCommand")}function k(a,b){var c=requireExtend("Nori.ModelCollection",b);return c.initialize(a),c}function l(a,b){var c=requireExtend("Nori.Model",b);return c.initialize(a),c}function m(a){E.add(a)}function n(a){return E.get(a)}function o(a){return s(a,require("Nori.ApplicationView"))}function p(a){C.routes.push(a)}function q(a){return C.routes.indexOf(a)>-1}function r(a){q(a.route)?(C.currentRoute=a,a.fromApp?M.setRoute(C.currentRoute.route,C.currentRoute.data):(M.runCurrentRoute(),L.publish(I.ROUTE_CHANGED,a))):M.setRoute(C.currentRoute.route,C.currentRoute.data)}function s(a,b){return a=_.assign({},b,a),a._super=b,a}function t(a){return s(a,this)}function u(a,b){G[a]=L.subscribeCommand(a,b)}function v(a,b,c){M.when(a,{templateID:b,controller:function(a){c.execute(a)}})}function w(a,b,c){p(a),D.mapRouteView(b,c),M.when(a,{templateID:b,controller:function(a){x(a)}})}function x(a){D.showRouteView(a,z(a.templateID))}function y(a,b){F.set(a,b)}function z(a){return F.get(a)||{}}function A(a,b){var c=H[a];c?-1===c.indexOf(b)&&c.push(b):c=[b],H[a]=c}function B(a,b){var c=H[a];c&&c.forEach(function(a){D.updateViewData(a,b)})}var C,D,E,F,G=Object.create(null),H=Object.create(null),I=require("Nori.Events.AppEvents"),J=require("nudoru.events.BrowserEvents"),K=require("nudoru.utils.ObjectUtils"),L=require("Nori.Events.Emitter"),M=require("Nori.Router");return{initialize:e,config:d,getEmitter:a,router:b,view:c,createModelCollection:k,createModel:l,addModel:m,getModel:n,createApplicationView:o,setCurrentRoute:r,mapRouteView:w,mapRouteCommand:v,mapEventCommand:u,extend:s,createApplication:t,storeSubViewData:y,retrieveSubViewData:z,bindModelView:A,notifyBoundViewsOfModelUpdate:B}}();