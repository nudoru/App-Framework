/*! app-framework 04-06-2015 */
define("Nori.Events.AppEvents",function(a,b,c){c.APP_INITIALIZED="APP_INITIALIZED",c.MODEL_DATA_WAITING="MODEL_DATA_WAITING",c.MODEL_DATA_READY="MODEL_DATA_READY",c.MODEL_DATA_CHANGED="MODEL_DATA_CHANGED",c.MODEL_DATA_SAVED="MODEL_DATA_SAVED",c.MODEL_DATA_DESTROYED="MODEL_DATA_DESTROYED",c.UPDATE_MODEL_DATA="UPDATE_MODEL_DATA",c.RESUME_FROM_MODEL_STATE="RESUME_FROM_MODEL_STATE",c.VIEW_INITIALIZED="VIEW_INITIALIZED",c.VIEW_RENDERED="VIEW_RENDERED",c.VIEW_CHANGED="VIEW_CHANGED",c.VIEW_CHANGE_TO_MOBILE="VIEW_CHANGE_TO_MOBILE",c.VIEW_CHANGE_TO_DESKTOP="VIEW_CHANGE_TO_DESKTOP",c.ROUTE_CHANGED="ROUTE_CHANGED",c.CHANGE_ROUTE="CHANGE_ROUTE",c.SUBVIEW_STORE_STATE="SUBVIEW_STORE_STATE"}),define("Nori.Events.Emitter",function(a,b,c){function d(a,b,c){return h[a]||(h[a]=[]),h[a]={once:c,handler:b,subject:new Rx.Subject},h[a].subject.subscribe(b)}function e(b,c,e){var f=a(c);if(f.hasOwnProperty("execute"))return d(b,f.execute,e);throw new Error("Emitter cannot map "+b+" to command "+c+": must have execute()")}function f(a,b){var c=h[a];c&&(c.subject.onNext(b),c.once&&(c.subject.onCompleted(),c.subject.dispose(),c=null))}function g(){var a=h;for(var b in a)hasOwnProp.call(a,b)&&a[b].subject.dispose();h={}}var h={};c.subscribe=d,c.subscribeCommand=e,c.publish=f,c.dispose=g}),define("Nori.Model",function(a,b,c){function d(a){if(!a.id)throw new Error("Model must be init'd with an id");y=a.id,D=a.silent||!1,a.store&&g(a.store,{silent:!0})}function e(){return y}function f(){C={},A=!0}function g(a,b){var c=!1;"object"==typeof a?(null!==b&&"object"==typeof b&&(c=b.silent||!1),C=_.merge({},C,a)):C[a]=b,A=!0,c||s()}function h(a){return C[a]}function i(a){return C.hasOwnProperty(a)}function j(){if(!A&&B)return B;var a=[];for(var b in C)a.push({key:b,value:C[b]});return B=a,A=!1,a}function k(){return j().length}function l(){return j().map(function(a){return a.key})}function m(){return j().map(function(a){return a.value})}function n(a){return m().filter(a)}function o(){return j()[0]}function p(){var a=j();return a[a.length-1]}function q(a){return j()[a]}function r(){return _.merge({},C)}function s(){D||E.publish(F.MODEL_DATA_CHANGED,{id:y,storeType:"model",store:r()}),z&&z.publishChange({id:y,store:r()})}function t(){}function u(){C=null,z=null}function v(){return JSON.stringify(C)}function w(a){z=a}function x(){return z}var y,z,A=!1,B=[],C={},D=!1,E=a("Nori.Events.Emitter"),F=a("Nori.Events.AppEvents");c.initialize=d,c.getID=e,c.clear=f,c.set=g,c.get=h,c.has=i,c.keys=l,c.values=m,c.entries=j,c.filterValues=n,c.length=k,c.getFirst=o,c.getLast=p,c.getAtIndex=q,c.getStore=r,c.save=t,c.destroy=u,c.toJSON=v,c.setParentCollection=w,c.getParentCollection=x}),define("Nori.ModelCollection",function(a,b,c){function d(a){if(!a.id)throw new Error("ModelCollection must be init'd with an id");x=a.id,z=a.silent||!1}function e(a){a.forEach(function(a){h(a)})}function f(a,b,c){a.forEach(function(a){var d;d=a.hasOwnProperty(b)?a[b]:x+"child"+y.length,h(Nori.createModel({id:d,silent:c,store:a}))})}function g(){return x}function h(a){var b=k(a.getID());a.setParentCollection(this),b>=0?y[b]=a:y.push(a)}function i(a){var b=k(store.getID());b>=0?(y[b].setParentCollection(null),y[b]=null,y.splice(b,1)):console.log(x+" remove, model not in collection: "+a)}function j(a){return y.filter(function(b){return b.getID()===a})[0]}function k(a){return y.map(function(a){return a.getID()}).indexOf(a)}function l(a){z||A.publish(B.MODEL_DATA_CHANGED,{id:x,storeType:"collection",storeID:a.id,store:a.store})}function m(a){return y[a]?!0:!1}function n(){return y.length}function o(){return y[0]}function p(){return y[y.length-1]}function q(a){return y[a]}function r(a){return y.filter(a)}function s(){}function t(){}function u(){return JSON.stringify(y)}function v(a){_parentCollection=a}function w(){return _parentCollection}var x,y=[],z=!1,A=a("Nori.Events.Emitter"),B=a("Nori.Events.AppEvents");c.initialize=d,c.getID=g,c.add=h,c.addStoresFromArray=e,c.addFromObjArray=f,c.remove=i,c.getStore=j,c.hasModel=m,c.length=n,c.getFirst=o,c.getLast=p,c.getAtIndex=q,c.filterValues=r,c.save=s,c.destroy=t,c.toJSON=u,c.publishChange=l,c.setParentCollection=v,c.getParentCollection=w}),define("Nori.View.BaseSubView",function(a,b,c){function d(a){l?f(a):(l=a,m=a.id,n=a.template,q=r=e(a),g())}function e(a){return _.merge({},a.previousStateData,a.boundModelData,a.queryData)}function f(a){return r=e(a),console.log(m+", subview update state: "+JSON.stringify(r)),s?g():void 0}function g(){return o=n(r),p=t.HTMLStrToNode(o)}function h(){s=!0}function i(){s=!1,u.publish(v.SUBVIEW_STORE_STATE,{id:m,data:r})}function j(){return m}function k(){return p}var l,m,n,o,p,q,r,s=!1,t=a("nudoru.utils.DOMUtils"),u=a("Nori.Events.Emitter"),v=a("Nori.Events.AppEvents");c.initialize=d,c.update=f,c.render=g,c.getID=j,c.getDOMElement=k,c.viewDidMount=h,c.viewWillUnMount=i}),define("Nori.BasicView",function(a,b,c){function d(){f=this,g.publish(Nori.AppEvents.VIEW_INITIALIZED),e()}function e(){g.publish(Nori.AppEvents.VIEW_RENDERED)}var f,g=Nori.eventDispatcher();c.initialize=d,c.render=e}),define("Nori.View.MixinBrowserEvents",function(a,b,c){function d(){l(),n(),f()}function e(a){u=a}function f(){var a=Rx.Observable.fromEvent(window,"resize"),b=Rx.Observable.fromEvent(_mainScrollEl,"scroll");r=Rx.Observable.merge(a,b).subscribe(function(){o()}),t=Rx.Observable.fromEvent(window,"resize").throttle(100).subscribe(function(){i()}),s=Rx.Observable.fromEvent(_mainScrollEl,"scroll").throttle(100).subscribe(function(){j()})}function g(){return _mainScrollEl}function h(a){_mainScrollEl=document.getElementById(a)}function i(){v.publish(w.BROWSER_RESIZED,p)}function j(){v.publish(w.BROWSER_SCROLLED,q)}function k(){return p}function l(){p={width:window.innerWidth,height:window.innerHeight}}function m(){return q}function n(){var a=_mainScrollEl?_mainScrollEl:document.body,b=a.scrollLeft,c=a.scrollTop;b=b?b:0,c=c?c:0,q={left:b,top:c}}function o(){n(),l(),u.call(this,p,q)}var p,q,r,s,t,u,v=a("Nori.Events.Emitter"),w=a("nudoru.events.BrowserEvents");c.initializeEventStreams=d,c.setPositionUIElementsOnChangeCB=e,c.getMainScrollingView=g,c.setMainScrollingView=h,c.getCurrentViewPortSize=k,c.getCurrentViewPortScroll=m}),define("Nori.View.MixinMultiDeviceView",function(a,b,c){function d(){s=!1,t=750,u=475,v=250,w=!1,q=document.getElementById("app__contents"),n=document.getElementById("drawer"),o=document.querySelector(".drawer__menu-spinner-button > input"),n&&TweenLite.to(n,0,{x:-1*v}),e(),f()}function e(){r=Rx.Observable.fromEvent(window,"resize").throttle(10).subscribe(function(){f()}),o&&(p=Rx.Observable.fromEvent(o,"change").subscribe(function(){k()}))}function f(){g(),h()}function g(){x={width:window.innerWidth,height:window.innerHeight}}function h(){x.width<=t||z.mobile.any()?i():x.width>t&&j()}function i(){s||(s=!0,A.publish(y.VIEW_CHANGE_TO_MOBILE))}function j(){s&&(s=!1,m(),A.publish(y.VIEW_CHANGE_TO_DESKTOP))}function k(){w?m():l()}function l(){w=!0,TweenLite.to(n,.5,{x:0,ease:Quad.easeOut}),TweenLite.to(q,.5,{x:v,ease:Quad.easeOut})}function m(){w=!1,TweenLite.to(n,.5,{x:-1*v,ease:Quad.easeOut}),TweenLite.to(q,.5,{x:0,ease:Quad.easeOut})}var n,o,p,q,r,s,t,u,v,w,x,y=a("Nori.Events.AppEvents"),z=a("nudoru.utils.BrowserInfo"),A=a("nudoru.events.EventDispatcher");c.initialize=d,c.openDrawer=l,c.closeDrawer=m,c.checkForMobile=h}),define("Nori.View.MixinRouteViews",function(a,b,c){function d(a){j=document.getElementById(a)}function e(){return l}function f(a,b){var c=requireUnique(n),d=requireUnique(b);m[a]={htmlTemplate:l.getTemplate(o+a),controller:Nori.extend(d,c)}}function g(a,b,c){var d=m[a];d.controller.update&&d.controller.update({boundModelData:c})}function h(a,b){if(!j)throw new Error("No subview mount point set");var c=m[a.templateID];if(!c)throw new Error("No subview mapped for route: "+a.route+" > "+a.templateID);i(),c.controller.initialize({id:a.templateID,template:c.htmlTemplate,queryData:a.queryData,previousStateData:b}),TweenLite.set(j,{alpha:0}),j.appendChild(c.controller.getDOMElement()),k=a.templateID,c.controller.viewDidMount&&c.controller.viewDidMount(),TweenLite.to(j,.25,{alpha:1,ease:Quad.easeIn}),r.publish(p.VIEW_CHANGED,a.templateID)}function i(){if(k){var a=m[k].controller;a.viewWillUnMount&&a.viewWillUnMount()}k="",q.removeAllElements(j)}var j,k,l=a("Nori.View.Template"),m=Object.create(null),n="Nori.View.BaseSubView",o="template__",p=a("Nori.Events.AppEvents"),q=a("nudoru.utils.DOMUtils"),r=a("Nori.Events.Emitter");c.setSubViewMountPoint=d,c.template=e,c.mapView=f,c.showView=h,c.updateSubViewData=g}),define("Nori.View.Template",function(a,b,c){function d(a){if(i[a])return i[a];var b=document.getElementById(a),c="",d="";if(!b)throw new Error('nudoru.utils.NTemplate, template not found: "'+a+'"');return c=b.innerHTML,d=h(c),i[a]=d,d}function e(a){if(j[a])return j[a];var b=_.template(d(a));return j[a]=b,b}function f(a,b){var c=e(a);return c(b)}function g(a,b){return k.HTMLStrToNode(f(a,b))}function h(a){return a.trim()}var i=Object.create(null),j=Object.create(null),k=a("nudoru.utils.DOMUtils");c.getSource=d,c.getTemplate=e,c.asHTML=f,c.asElement=g}),define("Nori.View",function(a,b,c){function d(){return q}function e(){return r}function f(){g()}function g(){q=document.getElementById("app__container"),r=document.getElementById("app__contents"),s.setMainScrollingView("app__contents"),s.initializeEventStreams(),s.setPositionUIElementsOnChangeCB(h),t.setSubViewMountPoint("contents"),v.initialize("tooltip__container"),u.initialize("toast__container"),w.initialize("messagebox__container"),x.initialize()}function h(){}function i(a){w.add(a)}function j(a){i({title:"Alert",content:a,type:w.type().DEFAULT,modal:!1})}function k(a){u.add(a)}function l(a,b,c){k({title:b||"Notification",type:c||u.type().DEFAULT,message:a})}function m(){var a=document.getElementById("initialization__cover"),b=document.getElementsByClassName("initialization__message")[0];TweenLite.to(a,1,{alpha:0,ease:Quad.easeOut,onComplete:function(){document.body.removeChild(a)}}),TweenLite.to(b,2,{top:"+=50px",ease:Quad.easeIn,onComplete:function(){a.removeChild(b)}})}function n(a,b){t.mapView(a,b)}function o(a,b){t.showView(a,b)}function p(a,b,c){t.updateSubViewData(a,b,c)}var q,r,s=a("Nori.View.MixinBrowserEvents"),t=a("Nori.View.MixinRouteViews"),u=a("nudoru.components.ToastView"),v=a("nudoru.components.ToolTipView"),w=a("nudoru.components.MessageBoxView"),x=a("nudoru.components.ModalCoverView");c.initialize=f,c.addMessageBox=i,c.addNotification=k,c.alert=j,c.notify=l,c.removeLoadingMessage=m,c.mapView=n,c.showView=o,c.updateSubViewData=p,c.layoutUI=h,c.getAppContainerEl=d,c.getAppEl=e}),define("Nori.Router",function(a,b,c){function d(){window.addEventListener("hashchange",f,!1)}function e(a,b){n[a]={templateID:b.templateID,controller:b.controller}}function f(){o.publish(p.URL_HASH_CHANGED,{routeObj:g(),fragment:l()})}function g(){var a=l(),b=a.split("?"),c="/"+b[0],d=decodeURIComponent(b[1]),e=i(d);return{route:c,data:e}}function h(){var a=g();j(a.route,a.data)}function i(a){var b={},c=a.split("&");return c.forEach(function(a){var c=a.split("=");b[c[0]]=c[1]}),b}function j(a,b){var c=n[a];c?c.controller.call(window,{route:a,templateID:c.templateID,queryData:b}):console.log('No Route mapped for: "'+a+'"')}function k(a,b){var c=a,d=[];if(null!==b&&void 0!==b){c+="?";for(var e in b)"undefined"!==e&&b.hasOwnProperty(e)&&d.push(e+"="+encodeURIComponent(b[e]));c+=d.join("&")}m(c)}function l(){var a=location.hash.slice(1);return a.toString().replace(/\/$/,"").replace(/^\//,"")}function m(a){window.location.hash=a}var n=Object.create(null),o=a("Nori.Events.Emitter"),p=a("nudoru.events.BrowserEvents");c.initialize=d,c.when=e,c.getCurrentRoute=g,c.runCurrentRoute=h,c.setRoute=k}),define("Nori.BrowserResizedCommand",function(a,b,c){c.execute=function(a){console.log("BrowserResizedCommand: "+a.width+"w, "+a.height+"h")}}),define("Nori.BrowserScrolledCommand",function(a,b,c){c.execute=function(a){console.log("BrowserScrolledCommand: "+a.left+"l, "+a.top+"t")}}),define("Nori.ChangeRouteCommand",function(a,b,c){c.execute=function(a){a.fromApp=!0,Nori.setCurrentRoute(a)}}),define("Nori.InitializeAppCommand",function(a,b,c){c.execute=function(){a("nudoru.events.BrowserEvents"),a("Nori.Events.AppEvents");console.log("InitializeAppCommand"),Nori.mapRouteView("/","ControlsTesting","Nori.View.ControlsTestingSubView",!1),Nori.mapRouteView("/test","TestSubView","Nori.View.TemplateSubView",!0),Nori.mapRouteView("/one","TestSubView1","Nori.View.TemplateSubView",!0),Nori.mapRouteView("/two","TestSubView2","Nori.View.TemplateSubView",!0),Nori.mapRouteView("/three","TestSubView3","Nori.View.TemplateSubView",!0),Nori.view().removeLoadingMessage(),Nori.setCurrentRoute(Nori.router().getCurrentRoute())}}),define("Nori.ModelDataChangedCommand",function(a,b,c){c.execute=function(a){"model"===a.storeType&&Nori.notifyBoundViewsOfModelUpdate(a.id,a.store)}}),define("Nori.RouteChangedCommand",function(a,b,c){c.execute=function(){}}),define("Nori.SubViewStoreDataCommand",function(a,b,c){c.execute=function(a){Nori.storeSubViewData(a.id,a.data)}}),define("Nori.URLHashChangedCommand",function(a,b,c){c.execute=function(a){Nori.setCurrentRoute(a.routeObj)}}),define("Nori.UpdateModelDataCommand",function(a,b,c){c.execute=function(a){console.log("UpdateModelDataCommand, model id: "+a.id+", with data:"),console.table(a.data)}}),define("Nori.ViewChangedCommand",function(a,b,c){c.execute=function(a){console.log("ViewChangedCommand: "+a)}}),define("Nori.ViewChangedToDesktopCommand",function(a,b,c){c.execute=function(a){console.log("ViewChangedToDesktopCommand: "+a)}}),define("Nori.ViewChangedToMobileCommand",function(a,b,c){c.execute=function(a){console.log("ViewChangedToMobileCommand: "+a)}});var Nori=function(){function a(){return K}function b(){return L}function c(){return C}function d(){return J.extend({},B)}function e(a){f(),L.initialize(),C=a.view,g(),h(),i()}function f(){B={appConfig:APP_CONFIG_DATA,routes:[],currentRoute:{route:"/",data:void 0}}}function g(){E=l({id:"SubViewDataModel",store:{},noisy:!0}),D=k({id:"GlobalModelCollection",silent:!1}),m(E)}function h(){C.initialize()}function i(){j(),K.publish(H.APP_INITIALIZED)}function j(){t(H.MODEL_DATA_CHANGED,"Nori.ModelDataChangedCommand"),t(H.UPDATE_MODEL_DATA,"Nori.UpdateModelDataCommand"),t(I.URL_HASH_CHANGED,"Nori.URLHashChangedCommand"),t(H.CHANGE_ROUTE,"Nori.ChangeRouteCommand"),t(H.SUBVIEW_STORE_STATE,"Nori.SubViewStoreDataCommand")}function k(a){var b=_.assign({},requireUnique("Nori.ModelCollection"));return b.initialize(a),b}function l(a){var b=_.assign({},requireUnique("Nori.Model"));return b.initialize(a),b}function m(a){D.add(a)}function n(a){return D.get(a)}function o(a){B.routes.push(a)}function p(a){return B.routes.indexOf(a)>-1}function q(a){p(a.route)?(B.currentRoute=a,a.fromApp?L.setRoute(B.currentRoute.route,B.currentRoute.data):(L.runCurrentRoute(),K.publish(H.ROUTE_CHANGED,a))):L.setRoute(B.currentRoute.route,B.currentRoute.data)}function r(a,b){return a=_.assign({},b,a),a._super=b,a}function s(a){return r(a,this)}function t(a,b){F[a]=K.subscribeCommand(a,b)}function u(a,b,c){L.when(a,{templateID:b,controller:function(a){c.execute(a)}})}function v(a,b,c){o(a),C.mapView(b,c),L.when(a,{templateID:b,controller:function(a){w(a)}})}function w(a){C.showView(a,y(a.templateID))}function x(a,b){E.set(a,b)}function y(a){return E.get(a)||{}}function z(a,b){var c=G[a];c?-1===c.indexOf(b)&&c.push(b):c=[b],G[a]=c}function A(a,b){var c=G[a];c&&c.forEach(function(c){C.updateSubViewData(c,a,b)})}var B,C,D,E,F=Object.create(null),G=Object.create(null),H=require("Nori.Events.AppEvents"),I=require("nudoru.events.BrowserEvents"),J=require("nudoru.utils.ObjectUtils"),K=require("Nori.Events.Emitter"),L=require("Nori.Router");return{initialize:e,config:d,getEmitter:a,router:b,view:c,createModelCollection:k,createModel:l,addModel:m,getModel:n,setCurrentRoute:q,mapRouteView:v,mapRouteCommand:u,mapEventCommand:t,extend:r,create:s,storeSubViewData:x,retrieveSubViewData:y,bindModelView:z,notifyBoundViewsOfModelUpdate:A}}();