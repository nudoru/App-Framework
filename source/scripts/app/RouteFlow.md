# Flow of route changes in the Application

## Diagram
┌──────────────────────────┐                               ┌──────────────────────────┐
│ ┌──────────────────────┐ │                               │ ┌──────────────────────┐ │
│ │      URL Change      │ │░░                             │ │  change route event  │ │░░
│ └──────────────────────┘ │░░                             │ └──────────────────────┘ │░░
└─────────────┬────────────┘░░                             └─────────────┬────────────┘░░
  ░░░░░░░░░░░░│░░░░░░░░░░░░░░░                               ░░░░░░░░░░░░│░░░░░░░░░░░░░░░
┌─────────────▼────────────┐░░                             ┌─────────────▼────────────┐░░
│ ┌──────────────────────┐ │                               │ ┌──────────────────────┐ │
│ │ URLHashChangeCommand │ │                               │ │  RouteChangeCommand  │ │
│ └──────────────────────┘ │                               │ └──────────────────────┘ │
└─────────────┬────────────┘                               └─────────────┬────────────┘
              │                                                          │
              │              ┌──────────────────────────┐                │
              │              │ ┌──────────────────────┐ │                │
              └─────────────▶│ │ APP.setCurrentRoute  │ │◀───────────────┘
                             │ └──────────────────────┘ │
                             └─────────────┬────────────┘
                                           ▼
                                           Λ
                                          ╱ ╲
                                         ╱   ╲
                                        ╱     ╲
                                       ╱       ╲     ┌──────────────────────────┐
                                      ╱┌───────┐╲    │ ┌──────────────────────┐ │
                                     ▕ │mapped?│ ▏───▶ │ Router.setRoute(last │ │
                                      ╲└───────┘╱    │ │ valid stored route)  │ │
                                       ╲       ╱     │ └──────────────────────┘ │
                                        ╲     ╱      └──────────────────────────┘
                                         ╲   ╱
                                          ╲ ╱
                                           V

                             ┌──────────────────────────┐
                             │ ┌──────────────────────┐ │
                             │ │ store current route  │ │
                             │ └──────────────────────┘ │
                             └─────────────┬────────────┘
                                           ▼
                                           Λ
                                          ╱ ╲
                                         ╱   ╲
                                        ╱     ╲
       ┌──────────────────────────┐    ╱       ╲     ┌──────────────────────────┐
       │ ┌──────────────────────┐ │   ╱┌───────┐╲    │ ┌──────────────────────┐ │
       │ │Router.runCurrentRoute│ ◀──▕ │ from  │ ▏───▶ │   Router.setRoute    │ │
       │ └──────────────────────┘ │   ╲│ URL?  │╱    │ └──────────────────────┘ │
       └─────────────┬────────────┘    └───────┘     └─────────────┬────────────┘
                     │                  ╲     ╱                    │
                     │                   ╲   ╱                     │
                     │                    ╲ ╱                      │
                     │                     V                       │
                     │                                             │
                     │                                             │
                     │       ┌──────────────────────────┐          │
                     │       │ ┌──────────────────────┐ │          │
                     └──────▶│ │   Router.runRoute    │ │◀─────────┘
                             │ └──────────────────────┘ │
                             └─────────────┬────────────┘
                                           │
                             ┌─────────────▼────────────┐
                             │ ┌──────────────────────┐ │
                             │ │   route controller   │ │
                             │ │ call(window, {route, │ │
                             │ │  templateID, data})  │ │
                             │ └──────────────────────┘ │
                             └─────────────┬────────────┘
                                           │
                             ┌─────────────▼────────────┐   ┌───────────────────────┐
                             │ ┌──────────────────────┐ │   │Trigger's when() method│
                             │ │   Router.runRoute    │ │──▶│      set in the       │
                             │ └──────────────────────┘ │   │   APP.mapRouteView    │
                             └─────────────┬────────────┘   └───────────────────────┘
┌───────────────────────┐                  │
│ APP.model -> retrieve │    ┌─────────────▼────────────┐
│  stored model state,  │    │ ┌──────────────────────┐ │
│   will be passed to   │───▶│ │    View.showView     │ │
│ subview controller on │    │ └──────────────────────┘ │
│         init          │    └─────────────┬────────────┘
└───────────────────────┘                  │
                             ┌─────────────▼────────────┐  ┌──────────────────────────┐
                             │ ┌──────────────────────┐ │  │ ┌──────────────────────┐ │
                             │ │ unmount current view │ │──▶ │ subview.willUnmount  │ │──┐
                             │ └──────────────────────┘ │  │ └──────────────────────┘ │  │
                             └─────────────┬────────────┘  └──────────────────────────┘  │
                                           │                    ┌────────────────────────┘
                             ┌─────────────▼────────────┐       │
                             │ ┌──────────────────────┐ │       │  ┌───────────────────────┐
                             │ │subview.controller.ini│ │       │  │       emmit ->        │
                             │ └──────────────────────┘ │       └─▶│   SubViewStoreData    │
                             └─────────────┬────────────┘          └───────────────────────┘
                                           │                                   │
                             ┌─────────────▼────────────┐                      ▼
                             │ ┌──────────────────────┐ │          ┌───────────────────────┐
                             │ │  append to subview   │ │          │SubViewStoreDataCommand│
                             │ │      mountpoint      │ │          │                       │
                             │ └──────────────────────┘ │          └───────────────────────┘
                             └─────────────┬────────────┘                      │
                                           │                                   ▼
                             ┌─────────────▼────────────┐          ┌───────────────────────┐
                             │ ┌──────────────────────┐ │          │Model, save data under │
                             │ │ subview.viewDidMount │ │░░        │      subview ID       │
                             │ └──────────────────────┘ │░░        └───────────────────────┘
                             └──────────────────────────┘░░
                               ░░░░░░░░░░░░░░░░░░░░░░░░░░░░
                               ░░░░░░░░░░░░░░░░░░░░░░░░░░░░                           ░░░░░░░░░░░░░░░░░░░░░░░░░░░░