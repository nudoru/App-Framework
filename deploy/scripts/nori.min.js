/*! app-framework 03-06-2015 */
define("Nori.Events.AppEvents",function(a,b,c){c.APP_INITIALIZED="APP_INITIALIZED",c.MODEL_DATA_WAITING="MODEL_DATA_WAITING",c.MODEL_DATA_READY="MODEL_DATA_READY",c.MODEL_DATA_CHANGED="MODEL_DATA_CHANGED",c.MODEL_DATA_SAVED="MODEL_DATA_SAVED",c.MODEL_DATA_DESTROYED="MODEL_DATA_DESTROYED",c.UPDATE_MODEL_DATA="UPDATE_MODEL_DATA",c.RESUME_FROM_MODEL_STATE="RESUME_FROM_MODEL_STATE",c.VIEW_INITIALIZED="VIEW_INITIALIZED",c.VIEW_RENDERED="VIEW_RENDERED",c.VIEW_CHANGED="VIEW_CHANGED",c.VIEW_CHANGE_TO_MOBILE="VIEW_CHANGE_TO_MOBILE",c.VIEW_CHANGE_TO_DESKTOP="VIEW_CHANGE_TO_DESKTOP",c.ROUTE_CHANGED="ROUTE_CHANGED",c.CHANGE_ROUTE="CHANGE_ROUTE",c.SUBVIEW_STORE_STATE="SUBVIEW_STORE_STATE"}),define("Nori.Events.Emitter",function(a,b,c){function d(a,b,c){return h[a]||(h[a]=[]),h[a]={once:c,handler:b,subject:new Rx.Subject},h[a].subject.subscribe(b)}function e(b,c,e){var f=a(c);if(f.hasOwnProperty("execute"))return d(b,f.execute,e);throw new Error("Emitter cannot map "+b+" to command "+c+": must have execute()")}function f(a,b){var c=h[a];c&&(c.subject.onNext(b),c.once&&(c.subject.onCompleted(),c.subject.dispose(),c=null))}function g(){var a=h;for(var b in a)hasOwnProp.call(a,b)&&a[b].subject.dispose();h={}}var h={};c.subscribe=d,c.subscribeCommand=e,c.publish=f,c.dispose=g}),define("Nori.Model",function(a,b,c){function d(a){if(!a.id)throw new Error("Model must be init'd with an id");o=a.id,r=a.silent||!1,a.store&&f(a.store,{silent:!0})}function e(){return o}function f(a,b){var c=!1;"object"==typeof a?(null!==b&&"object"==typeof b&&(c=b.silent||!1),q=_.merge({},q,a)):q[a]=b,c||i()}function g(a){return q[a]}function h(){return _.merge({},q)}function i(){r||s.publish(t.MODEL_DATA_CHANGED,{id:o,storeType:"model",store:h()}),p&&p.publishChange({id:o,store:h()})}function j(){}function k(){q=null,p=null}function l(){return JSON.stringify(q)}function m(a){p=a}function n(){return p}var o,p,q=Object.create(null),r=!1,s=a("Nori.Events.Emitter"),t=a("Nori.Events.AppEvents");c.initialize=d,c.getID=e,c.set=f,c.get=g,c.store=h,c.save=j,c.destroy=k,c.toJSON=l,c.setParentCollection=m,c.getParentCollection=n}),define("Nori.ModelCollection",function(a,b,c){function d(a){if(!a.id)throw new Error("ModelCollection must be init'd with an id");o=a.id,q=a.silent||!1}function e(){return o}function f(a){var b=i(a.getID());a.setParentCollection(this),b>=0?p[b]=a:p.push(a)}function g(a){var b=i(store.getID());b>=0?(p[b].setParentCollection(null),p[b]=null,p.splice(b,1)):console.log(o+" remove, model not in collection: "+a)}function h(a){return p.filter(function(b){return b.getID()===a})[0]}function i(a){return p.map(function(a){return a.getID()}).indexOf(a)}function j(a){q||r.publish(s.MODEL_DATA_CHANGED,{id:o,storeType:"collection",storeID:a.id,store:a.store})}function k(a){return p[a]?!0:!1}function l(){}function m(){}function n(){return JSON.stringify(p)}var o,p=[],q=!1,r=a("Nori.Events.Emitter"),s=a("Nori.Events.AppEvents");c.initialize=d,c.getID=e,c.add=f,c.remove=g,c.getStore=h,c.hasModel=k,c.save=l,c.destroy=m,c.toJSON=n,c.publishChange=j}),define("Nori.View.BaseSubView",function(a,b,c){function d(a){l?f(a):(l=a,m=a.id,n=a.template,q=r=e(a),g())}function e(a){return _.merge({},a.previousStateData,a.boundModelData,a.queryData)}function f(a){return r=e(a),console.log(m+", subview update state: "+JSON.stringify(r)),s?g():void 0}function g(){return o=n(r),p=t.HTMLStrToNode(o)}function h(){s=!0}function i(){s=!1,u.publish(v.SUBVIEW_STORE_STATE,{id:m,data:r})}function j(){return m}function k(){return p}var l,m,n,o,p,q,r,s=!1,t=a("nudoru.utils.DOMUtils"),u=a("Nori.Events.Emitter"),v=a("Nori.Events.AppEvents");c.initialize=d,c.update=f,c.render=g,c.getID=j,c.getDOMElement=k,c.viewDidMount=h,c.viewWillUnMount=i}),define("Nori.BasicView",function(a,b,c){function d(){f=this,g.publish(Nori.AppEvents.VIEW_INITIALIZED),e()}function e(){g.publish(Nori.AppEvents.VIEW_RENDERED)}var f,g=Nori.eventDispatcher();c.initialize=d,c.render=e}),define("Nori.View.MixinBrowserEvents",function(a,b,c){function d(){l(),n(),f()}function e(a){u=a}function f(){var a=Rx.Observable.fromEvent(window,"resize"),b=Rx.Observable.fromEvent(_mainScrollEl,"scroll");r=Rx.Observable.merge(a,b).subscribe(function(){o()}),t=Rx.Observable.fromEvent(window,"resize").throttle(100).subscribe(function(){i()}),s=Rx.Observable.fromEvent(_mainScrollEl,"scroll").throttle(100).subscribe(function(){j()})}function g(){return _mainScrollEl}function h(a){_mainScrollEl=document.getElementById(a)}function i(){v.publish(w.BROWSER_RESIZED,p)}function j(){v.publish(w.BROWSER_SCROLLED,q)}function k(){return p}function l(){p={width:window.innerWidth,height:window.innerHeight}}function m(){return q}function n(){var a=_mainScrollEl?_mainScrollEl:document.body,b=a.scrollLeft,c=a.scrollTop;b=b?b:0,c=c?c:0,q={left:b,top:c}}function o(){n(),l(),u.call(this,p,q)}var p,q,r,s,t,u,v=a("Nori.Events.Emitter"),w=a("nudoru.events.BrowserEvents");c.initializeEventStreams=d,c.setPositionUIElementsOnChangeCB=e,c.getMainScrollingView=g,c.setMainScrollingView=h,c.getCurrentViewPortSize=k,c.getCurrentViewPortScroll=m}),define("Nori.View.MixinMultiDeviceView",function(a,b,c){function d(){s=!1,t=750,u=475,v=250,w=!1,q=document.getElementById("app__contents"),n=document.getElementById("drawer"),o=document.querySelector(".drawer__menu-spinner-button > input"),n&&TweenLite.to(n,0,{x:-1*v}),e(),f()}function e(){r=Rx.Observable.fromEvent(window,"resize").throttle(10).subscribe(function(){f()}),o&&(p=Rx.Observable.fromEvent(o,"change").subscribe(function(){k()}))}function f(){g(),h()}function g(){x={width:window.innerWidth,height:window.innerHeight}}function h(){x.width<=t||z.mobile.any()?i():x.width>t&&j()}function i(){s||(s=!0,A.publish(y.VIEW_CHANGE_TO_MOBILE))}function j(){s&&(s=!1,m(),A.publish(y.VIEW_CHANGE_TO_DESKTOP))}function k(){w?m():l()}function l(){w=!0,TweenLite.to(n,.5,{x:0,ease:Quad.easeOut}),TweenLite.to(q,.5,{x:v,ease:Quad.easeOut})}function m(){w=!1,TweenLite.to(n,.5,{x:-1*v,ease:Quad.easeOut}),TweenLite.to(q,.5,{x:0,ease:Quad.easeOut})}var n,o,p,q,r,s,t,u,v,w,x,y=a("Nori.Events.AppEvents"),z=a("nudoru.utils.BrowserInfo"),A=a("nudoru.events.EventDispatcher");c.initialize=d,c.openDrawer=l,c.closeDrawer=m,c.checkForMobile=h}),define("Nori.View.MixinRouteViews",function(a,b,c){function d(a){j=document.getElementById(a)}function e(){return l}function f(a,b){var c=requireUnique(n),d=requireUnique(b);m[a]={htmlTemplate:l.getTemplate(o+a),controller:Nori.extend(d,c)}}function g(a,b,c){var d=m[a];d.controller.update&&d.controller.update({boundModelData:c})}function h(a,b){if(!j)throw new Error("No subview mount point set");var c=m[a.templateID];if(!c)throw new Error("No subview mapped for route: "+a.route+" > "+a.templateID);i(),c.controller.initialize({id:a.templateID,template:c.htmlTemplate,queryData:a.queryData,previousStateData:b}),TweenLite.set(j,{alpha:0}),j.appendChild(c.controller.getDOMElement()),k=a.templateID,c.controller.viewDidMount&&c.controller.viewDidMount(),TweenLite.to(j,.25,{alpha:1,ease:Quad.easeIn}),r.publish(p.VIEW_CHANGED,a.templateID)}function i(){if(k){var a=m[k].controller;a.viewWillUnMount&&a.viewWillUnMount()}k="",q.removeAllElements(j)}var j,k,l=a("Nori.View.Template"),m=Object.create(null),n="Nori.View.BaseSubView",o="template__",p=a("Nori.Events.AppEvents"),q=a("nudoru.utils.DOMUtils"),r=a("Nori.Events.Emitter");c.setSubViewMountPoint=d,c.template=e,c.mapView=f,c.showView=h,c.updateSubViewData=g}),define("Nori.View.Template",function(a,b,c){function d(a){if(i[a])return i[a];var b=document.getElementById(a),c="",d="";if(!b)throw new Error('nudoru.utils.NTemplate, template not found: "'+a+'"');return c=b.innerHTML,d=h(c),i[a]=d,d}function e(a){if(j[a])return j[a];var b=_.template(d(a));return j[a]=b,b}function f(a,b){var c=e(a);return c(b)}function g(a,b){return k.HTMLStrToNode(f(a,b))}function h(a){return a.trim()}var i=Object.create(null),j=Object.create(null),k=a("nudoru.utils.DOMUtils");c.getSource=d,c.getTemplate=e,c.asHTML=f,c.asElement=g}),define("Nori.View",function(a,b,c){function d(){return q}function e(){return r}function f(){g()}function g(){q=document.getElementById("app__container"),r=document.getElementById("app__contents"),s.setMainScrollingView("app__contents"),s.initializeEventStreams(),s.setPositionUIElementsOnChangeCB(h),t.setSubViewMountPoint("contents"),v.initialize("tooltip__container"),u.initialize("toast__container"),w.initialize("messagebox__container"),x.initialize()}function h(){}function i(a){w.add(a)}function j(a){i({title:"Alert",content:a,type:w.type().DEFAULT,modal:!1})}function k(a){u.add(a)}function l(a,b,c){k({title:b||"Notification",type:c||u.type().DEFAULT,message:a})}function m(){var a=document.getElementById("initialization__cover"),b=document.getElementsByClassName("initialization__message")[0];TweenLite.to(a,1,{alpha:0,ease:Quad.easeOut,onComplete:function(){document.body.removeChild(a)}}),TweenLite.to(b,2,{top:"+=50px",ease:Quad.easeIn,onComplete:function(){a.removeChild(b)}})}function n(a,b){t.mapView(a,b)}function o(a,b){t.showView(a,b)}function p(a,b,c){t.updateSubViewData(a,b,c)}var q,r,s=a("Nori.View.MixinBrowserEvents"),t=a("Nori.View.MixinRouteViews"),u=a("nudoru.components.ToastView"),v=a("nudoru.components.ToolTipView"),w=a("nudoru.components.MessageBoxView"),x=a("nudoru.components.ModalCoverView");c.initialize=f,c.addMessageBox=i,c.addNotification=k,c.alert=j,c.notify=l,c.removeLoadingMessage=m,c.mapView=n,c.showView=o,c.updateSubViewData=p,c.layoutUI=h,c.getAppContainerEl=d,c.getAppEl=e}),define("Nori.Router",function(a,b,c){function d(){window.addEventListener("hashchange",f,!1)}function e(a,b){n[a]={templateID:b.templateID,controller:b.controller}}function f(){o.publish(p.URL_HASH_CHANGED,{routeObj:g(),fragment:l()})}function g(){var a=l(),b=a.split("?"),c="/"+b[0],d=decodeURIComponent(b[1]),e=i(d);return{route:c,data:e}}function h(){var a=g();j(a.route,a.data)}function i(a){var b={},c=a.split("&");return c.forEach(function(a){var c=a.split("=");b[c[0]]=c[1]}),b}function j(a,b){var c=n[a];c?c.controller.call(window,{route:a,templateID:c.templateID,queryData:b}):console.log('No Route mapped for: "'+a+'"')}function k(a,b){var c=a,d=[];if(null!==b&&void 0!==b){c+="?";for(var e in b)"undefined"!==e&&b.hasOwnProperty(e)&&d.push(e+"="+encodeURIComponent(b[e]));c+=d.join("&")}m(c)}function l(){var a=location.hash.slice(1);return a.toString().replace(/\/$/,"").replace(/^\//,"")}function m(a){window.location.hash=a}var n=Object.create(null),o=a("Nori.Events.Emitter"),p=a("nudoru.events.BrowserEvents");c.initialize=d,c.when=e,c.getCurrentRoute=g,c.runCurrentRoute=h,c.setRoute=k}),define("Nori.BrowserResizedCommand",function(a,b,c){c.execute=function(a){console.log("BrowserResizedCommand: "+a.width+"w, "+a.height+"h")}}),define("Nori.BrowserScrolledCommand",function(a,b,c){c.execute=function(a){console.log("BrowserScrolledCommand: "+a.left+"l, "+a.top+"t")}}),define("Nori.ChangeRouteCommand",function(a,b,c){c.execute=function(a){a.fromApp=!0,Nori.setCurrentRoute(a)}}),define("Nori.InitializeAppCommand",function(a,b,c){c.execute=function(){a("nudoru.events.BrowserEvents"),a("Nori.Events.AppEvents");console.log("InitializeAppCommand"),Nori.mapRouteView("/","ControlsTesting","Nori.View.ControlsTestingSubView",!1),Nori.mapRouteView("/test","TestSubView","Nori.View.TemplateSubView",!0),Nori.mapRouteView("/one","TestSubView1","Nori.View.TemplateSubView",!0),Nori.mapRouteView("/two","TestSubView2","Nori.View.TemplateSubView",!0),Nori.mapRouteView("/three","TestSubView3","Nori.View.TemplateSubView",!0),Nori.view().removeLoadingMessage(),Nori.setCurrentRoute(Nori.router().getCurrentRoute())}}),define("Nori.ModelDataChangedCommand",function(a,b,c){c.execute=function(a){"model"===a.storeType&&Nori.notifyBoundViewsOfModelUpdate(a.id,a.store)}}),define("Nori.RouteChangedCommand",function(a,b,c){c.execute=function(){}}),define("Nori.SubViewStoreDataCommand",function(a,b,c){c.execute=function(a){Nori.storeSubViewData(a.id,a.data)}}),define("Nori.URLHashChangedCommand",function(a,b,c){c.execute=function(a){Nori.setCurrentRoute(a.routeObj)}}),define("Nori.UpdateModelDataCommand",function(a,b,c){c.execute=function(a){console.log("UpdateModelDataCommand, model id: "+a.id+", with data:"),console.table(a.data)}}),define("Nori.ViewChangedCommand",function(a,b,c){c.execute=function(a){console.log("ViewChangedCommand: "+a)}}),define("Nori.ViewChangedToDesktopCommand",function(a,b,c){c.execute=function(a){console.log("ViewChangedToDesktopCommand: "+a)}}),define("Nori.ViewChangedToMobileCommand",function(a,b,c){c.execute=function(a){console.log("ViewChangedToMobileCommand: "+a)}});var Nori=function(){function a(){return J}function b(){return K}function c(){return B}function d(){return I.extend({},A)}function e(a){f(),K.initialize(),B=a.view,g(),h(),i()}function f(){A={appConfig:APP_CONFIG_DATA,routes:[],currentRoute:{route:"/",data:void 0}}}function g(){C=k({}),C.initialize({id:"SubViewDataModel",store:{},noisy:!0}),D.initialize({id:"GlobalModelCollection",silent:!1}),l(C)}function h(){B.initialize()}function i(){j(),J.publish(G.APP_INITIALIZED)}function j(){s(G.MODEL_DATA_CHANGED,"Nori.ModelDataChangedCommand"),s(G.UPDATE_MODEL_DATA,"Nori.UpdateModelDataCommand"),s(H.URL_HASH_CHANGED,"Nori.URLHashChangedCommand"),s(G.CHANGE_ROUTE,"Nori.ChangeRouteCommand"),s(G.SUBVIEW_STORE_STATE,"Nori.SubViewStoreDataCommand")}function k(){return _.assign({},requireUnique("Nori.Model"))}function l(a){D.add(a)}function m(a){return D.get(a)}function n(a){A.routes.push(a)}function o(a){return A.routes.indexOf(a)>-1}function p(a){o(a.route)?(A.currentRoute=a,a.fromApp?K.setRoute(A.currentRoute.route,A.currentRoute.data):(K.runCurrentRoute(),J.publish(G.ROUTE_CHANGED,a))):K.setRoute(A.currentRoute.route,A.currentRoute.data)}function q(a,b){return a=_.assign({},b,a),a._super=b,a}function r(a){return q(a,this)}function s(a,b){E[a]=J.subscribeCommand(a,b)}function t(a,b,c){K.when(a,{templateID:b,controller:function(a){c.execute(a)}})}function u(a,b,c){n(a),B.mapView(b,c),K.when(a,{templateID:b,controller:function(a){v(a)}})}function v(a){B.showView(a,x(a.templateID))}function w(a,b){C.set(a,b)}function x(a){return C.get(a)||{}}function y(a,b){var c=F[a];c?-1===c.indexOf(b)&&c.push(b):c=[b],F[a]=c}function z(a,b){var c=F[a];c&&c.forEach(function(c){B.updateSubViewData(c,a,b)})}var A,B,C,D=requireUnique("Nori.ModelCollection"),E=Object.create(null),F=Object.create(null),G=require("Nori.Events.AppEvents"),H=require("nudoru.events.BrowserEvents"),I=require("nudoru.utils.ObjectUtils"),J=require("Nori.Events.Emitter"),K=require("Nori.Router");return{initialize:e,config:d,getEmitter:a,router:b,view:c,createModel:k,addModel:l,getModel:m,setCurrentRoute:p,mapRouteView:u,mapRouteCommand:t,mapEventCommand:s,extend:q,create:r,storeSubViewData:w,retrieveSubViewData:x,bindModelView:y,notifyBoundViewsOfModelUpdate:z}}();